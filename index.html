<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Quote Reels</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        overflow: hidden;
        background: #000;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        -webkit-overflow-scrolling: touch;
      }

      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        padding: 12px 16px;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.6) 0%,
          transparent 100%
        );
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 100;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 20px;
        font-weight: 700;
      }

      .camera-icon {
        font-size: 28px;
      }

      .reels-container {
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .reels-container::-webkit-scrollbar {
        display: none;
      }

      .reel-card {
        height: 100vh;
        width: 100vw;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        position: relative;
        overflow: hidden;
      }

      .background-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.5);
      }

      .gradient-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.3) 0%,
          rgba(0, 0, 0, 0.1) 50%,
          rgba(0, 0, 0, 0.4) 100%
        );
      }

      .quote-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: white;
        z-index: 2;
        width: 85%;
        max-width: 500px;
      }

      .quote-text {
        font-size: clamp(1.8rem, 6vw, 2.8rem);
        font-weight: 700;
        line-height: 1.3;
        margin-bottom: 20px;
        text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
        letter-spacing: -0.5px;
      }

      .quote-author {
        font-size: clamp(1.1rem, 4vw, 1.4rem);
        font-weight: 500;
        opacity: 0.95;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
      }

      .sidebar {
        position: fixed;
        right: 12px;
        bottom: 80px;
        z-index: 10;
        display: flex;
        flex-direction: column;
        gap: 24px;
        align-items: center;
      }

      .sidebar-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .sidebar-btn:active {
        transform: scale(0.9);
      }

      .icon {
        font-size: 28px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
      }

      .icon-text {
        font-size: 12px;
        font-weight: 600;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      }

      .profile-pic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid white;
        object-fit: cover;
      }

      .bottom-info {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 16px;
        background: linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.6) 0%,
          transparent 100%
        );
        color: white;
        z-index: 10;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
      }

      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 1.5px solid white;
      }

      .username {
        font-size: 14px;
        font-weight: 600;
        flex: 1;
      }

      .follow-btn {
        padding: 6px 16px;
        background: transparent;
        border: 1px solid white;
        color: white;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
      }

      .description {
        font-size: 13px;
        line-height: 1.4;
        margin-bottom: 8px;
      }

      .audio-info {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
      }

      .audio-icon {
        font-size: 14px;
      }

      .loading-indicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 16px;
        display: none;
        z-index: 200;
      }

      .spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 12px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .liked {
        color: #ff4458 !important;
      }

      .saved {
        color: white !important;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-left">
        <span class="camera-icon">üì∑</span>
        <span>Reels</span>
      </div>
      <div class="camera-icon">üìπ</div>
    </div>

    <div class="reels-container" id="reelsContainer"></div>

    <div class="sidebar" id="sidebar">
      <button class="sidebar-btn" onclick="toggleLike()">
        <span class="icon" id="likeIcon">ü§ç</span>
        <span class="icon-text" id="likeCount">1.2K</span>
      </button>
      <button class="sidebar-btn" onclick="showComments()">
        <span class="icon">üí¨</span>
        <span class="icon-text">89</span>
      </button>
      <button class="sidebar-btn" onclick="shareReel()">
        <span class="icon">‚úàÔ∏è</span>
        <span class="icon-text">Share</span>
      </button>
      <button class="sidebar-btn" onclick="toggleSave()">
        <span class="icon" id="saveIcon">üîñ</span>
      </button>
      <button class="sidebar-btn">
        <span class="icon">‚ãØ</span>
      </button>
      <img
        src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40'%3E%3Crect width='40' height='40' rx='20' fill='%23667eea'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='white'%3Eüë§%3C/text%3E%3C/svg%3E"
        alt="Profile"
        class="profile-pic"
      />
    </div>

    <div class="bottom-info">
      <div class="user-info">
        <img
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Crect width='32' height='32' rx='16' fill='%23f093fb'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='16' fill='white'%3Eüë§%3C/text%3E%3C/svg%3E"
          alt="User"
          class="user-avatar"
        />
        <span class="username" id="username">inspirational_quotes</span>
        <button class="follow-btn">Follow</button>
      </div>
      <div class="description" id="description">
        Daily motivation to inspire your journey ‚ú®
      </div>
      <div class="audio-info">
        <span class="audio-icon">üéµ</span>
        <span>Original Audio</span>
      </div>
    </div>

    <div class="loading-indicator" id="loadingIndicator">
      <div class="spinner"></div>
      Loading...
    </div>

    <script>
      const API_URL = "https://kimiquotes.pages.dev/api/quote";
      const container = document.getElementById("reelsContainer");
      const loadingIndicator = document.getElementById("loadingIndicator");

      let quotes = [];
      let quoteIds = new Set();
      let preloadedQuotes = [];
      const PRELOAD_BUFFER = 3;
      let currentIndex = 0;
      let isLiked = false;
      let isSaved = false;

      const gradients = [
        "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
        "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
        "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",
        "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",
        "linear-gradient(135deg, #fa709a 0%, #fee140 100%)",
        "linear-gradient(135deg, #30cfd0 0%, #330867 100%)",
        "linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",
        "linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)",
      ];

      const usernames = [
        "daily_motivation",
        "quote_wisdom",
        "inspire_daily",
        "life_quotes",
        "motivational_hub",
      ];
      const descriptions = [
        "Daily motivation to inspire your journey ‚ú®",
        "Wisdom for your soul üí´",
        "Inspiring words that matter üåü",
        "Life lessons & motivation üí™",
        "Your daily dose of inspiration ‚ö°",
      ];

      async function fetchQuote() {
        try {
          const response = await fetch(API_URL);
          const data = await response.json();

          const newQuote = {
            id: data.id,
            text: data.quote,
            username: usernames[Math.floor(Math.random() * usernames.length)],
            description:
              descriptions[Math.floor(Math.random() * descriptions.length)],
          };

          if (!quoteIds.has(newQuote.id)) {
            return newQuote;
          }
          return null;
        } catch (err) {
          console.error("Error fetching quote:", err);
          return null;
        }
      }

      async function preloadQuotes() {
        while (preloadedQuotes.length < PRELOAD_BUFFER) {
          const quote = await fetchQuote();
          if (quote) {
            preloadedQuotes.push(quote);
            quoteIds.add(quote.id);
          }
        }
      }

      async function getNextQuote() {
        if (preloadedQuotes.length === 0) {
          if (loadingIndicator) loadingIndicator.style.display = "block";
          await preloadQuotes();
          if (loadingIndicator) loadingIndicator.style.display = "none";
        }

        const quote = preloadedQuotes.shift();

        if (quote) {
          renderQuotes([quote]);
        }

        if (preloadedQuotes.length < PRELOAD_BUFFER) {
          preloadQuotes();
        }
      }

      function createReelCard(quote, index) {
        const card = document.createElement("div");
        card.className = "reel-card";

        const gradient = gradients[index % gradients.length];

        card.innerHTML = `
                <div class="background-image" style="background: ${gradient}"></div>
                <div class="gradient-overlay"></div>
                <div class="quote-content">
                    <div class="quote-text">"${quote.text}"</div>
                </div>
            `;

        return card;
      }

      function renderQuotes(newQuotes) {
        const fragment = document.createDocumentFragment();

        newQuotes.forEach((q, idx) => {
          fragment.appendChild(createReelCard(q, quotes.length + idx));
        });

        container.appendChild(fragment);
        quotes = quotes.concat(newQuotes);
      }

      function updateBottomInfo(quote) {
        document.getElementById("username").textContent = quote.username;
        document.getElementById("description").textContent = quote.description;
      }

      let isScrolling;
      container.addEventListener("scroll", () => {
        clearTimeout(isScrolling);

        isScrolling = setTimeout(() => {
          const cards = container.querySelectorAll(".reel-card");
          const containerRect = container.getBoundingClientRect();

          cards.forEach((card, index) => {
            const cardRect = card.getBoundingClientRect();
            const cardCenter = cardRect.top + cardRect.height / 2;
            const containerCenter =
              containerRect.top + containerRect.height / 2;

            if (Math.abs(cardCenter - containerCenter) < cardRect.height / 2) {
              currentIndex = index;

              if (quotes[index]) {
                updateBottomInfo(quotes[index]);
              }

              if (index >= cards.length - 2) {
                getNextQuote();
              }
            }
          });
        }, 100);
      });

      function toggleLike() {
        const likeIcon = document.getElementById("likeIcon");
        const likeCount = document.getElementById("likeCount");
        isLiked = !isLiked;

        if (isLiked) {
          likeIcon.textContent = "‚ù§Ô∏è";
          likeIcon.classList.add("liked");
          likeCount.textContent = "1.3K";
        } else {
          likeIcon.textContent = "ü§ç";
          likeIcon.classList.remove("liked");
          likeCount.textContent = "1.2K";
        }
      }

      function toggleSave() {
        const saveIcon = document.getElementById("saveIcon");
        isSaved = !isSaved;

        if (isSaved) {
          saveIcon.textContent = "üè∑Ô∏è";
          saveIcon.classList.add("saved");
        } else {
          saveIcon.textContent = "üîñ";
          saveIcon.classList.remove("saved");
        }
      }

      function showComments() {
        alert("Comments feature - Coming soon! üí¨");
      }

      function shareReel() {
        alert("Share this amazing quote with your friends! ‚úàÔ∏è");
      }

      async function init() {
        if (loadingIndicator) loadingIndicator.style.display = "block";

        await preloadQuotes();

        for (let i = 0; i < 3 && preloadedQuotes.length > 0; i++) {
          const quote = preloadedQuotes.shift();
          renderQuotes([quote]);
        }

        if (quotes.length > 0) {
          updateBottomInfo(quotes[0]);
        }

        if (loadingIndicator) loadingIndicator.style.display = "none";

        preloadQuotes();
      }

      init();
    </script>
  </body>
</html>
